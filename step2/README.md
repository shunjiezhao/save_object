# 这是数据去重和校验
1. 如果我们重复 上传一个 文件 只会让版本号+1 然后存入 es，但是该文件还是会存入 dataServer
    需要去重，对象存储是一个服务，如果我们全盘接收来自客户端的数据，而不对这个散列值
   进行校验, 用户就会恶意篡改头部，我们文件名不同但是存储的东西都是一样的，所以我们需要进行检验
## SIS
也就是通过对该对象的散列值进行 单例检查（ Single Instance Storage, SIS ）来实现。具体来说，每次当接口服务节点接收到对象的 PUT 请求之后，我们都会进行一次定位，如果 PUT 对象的散列值己经存
在于数据服务中，我们就会跳过之后的数据服务 PUT 请求，直接生成该对象的新版本 插入元数据服务：如果 PUT 对象的散列值不存在于数据服务中，说明这是一个全新的 对象 。 接口服务会读取 PUT 请求的正文，写入数据服务 。

## 需要数据校验的原因 一般来说，客户端上传的数据不一致可能由以下几种情况导致。
1. 客户端是一个恶意客户端，故意上传不一致的数据给服务器。 
2. 客户端有 bug，计算出来的数据是错误的 。
3. 客户端计算的数据正确，但是传输过程中发生了错误
有了数据校验，我们才能确保 数据服务中保存的对象数据和散列值一致，然后放心对后续上传的对象根据散列值 进行去重 。
## 问题： 我们现在上床文件是 通过 put 将管道打通，io.Copy() 如果内存不够？OOM

### 实现数据校验的方法 给数据服务加入缓存功能
而是传输到某个数据服务节点的 一个临时对象里，井在传输数据的同时计算其散列值。当整个数据传输完毕以后，散 列值计算也同步完成，如果一致，接口节点需要将临时对象转成正式对象；如果不一 致， 则将临时对象删除。
本章接口服务的功能没有发生变化，数据服务删除了。均创s 接口的 PUT 方法井新 增了 temp 接口的 POST, PATCH 、 PUT 、 DELETE4 种方法作为替代。
POST /temp/<hash>
header: size
response: uuid
接口服务以 POST 方法访问数据服务 temp 接口，在 URL 的＜hash＞部分指定对象散 列值，并提供一个名为 size 的 H甘P 请求头部，用于指定对象的大小 。 这会在数据服务 节点上创建一个临时对象。该接口返回一个随机生成的 uuid （见其官方网站）用以标识 这个临时对象，后续操作通过 uuid 进行
PATCH /temp/<uuid>
request: 对象内容
接口服务以 PATCH 方法访问数据服务节点上的临时对象， HTTP 请求的正文会被 写入该临时对象 。

PUT /temp/<uuid>
接口服务数据校验一致，调用 PUT 方法将该临时文件转正 。

DELETE /temp/<uuid>
接口服务数据校验不一致，调用 DELETE 方法将该临时文件删除 。